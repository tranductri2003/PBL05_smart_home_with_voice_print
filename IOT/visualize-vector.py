import matplotlib.pyplot as plt

import speaker_recognition.neural_net as neural_net
import speaker_recognition.inference as inference

# Các vector nhúng
embeddings = {
    "Trần Đức Trí": [[-0.14439772069454193, 0.17611965537071228, -0.0401073656976223, -0.06835953891277313, 0.0013577718054875731, 0.10450614988803864, -0.08802343159914017, 0.15920409560203552, 0.12778612971305847, -0.03952135890722275, -0.018221016973257065, 0.2173241525888443, 0.08191250264644623, 0.22159960865974426, -0.16521210968494415, -0.20036408305168152, -0.0242467001080513, 0.054652903228998184, -0.013595383614301682, -0.07287073135375977, 0.15290901064872742, 0.14516739547252655, 0.14667682349681854, -0.1500386744737625, 0.029642881825566292, -0.17423580586910248, 0.05620546266436577, -0.12927088141441345, -0.004273668397217989, -0.18219618499279022, 0.00019209344463888556, -0.059034012258052826, 0.06816701591014862, 0.02437721937894821, -0.13144059479236603, -0.25355783104896545, -0.014956975355744362, -0.138662651181221, 0.14842315018177032, -0.025287870317697525, -0.20806775987148285, 0.24674224853515625, 0.11332033574581146, -0.06576329469680786, -0.0977516770362854, -0.19361422955989838, -0.06220461055636406, 0.03367936238646507, -0.13054540753364563, 0.09751255065202713, 0.037712424993515015, 0.08741346746683121, -0.08632996678352356, -0.11854624003171921, 0.2179573029279709, 0.12501531839370728, 0.040046680718660355, -0.2237464338541031, 0.1602756828069687, -0.05943657457828522, -0.07490821182727814, -0.07503336668014526, -0.14615599811077118, 0.07610015571117401, 0.25221407413482666, -0.001017554895952344, 0.06143402308225632, 0.07091024518013, 0.21817858517169952, 0.12041948735713959, -0.17542649805545807, -0.06849866360425949, 0.031814586371183395, 0.02077545039355755, 0.20304200053215027, 0.03196880593895912, -0.003929164260625839, 0.049363330006599426, 0.2107044905424118, -0.011224256828427315, 0.06855195760726929, -0.02337283082306385, -0.04596787318587303, 0.019558094441890717, -0.0065399049781262875, 0.17933766543865204, -0.16123634576797485, -0.04232136905193329, -0.020897813141345978, 0.040349576622247696, 0.02292250283062458, -0.2507643401622772, 0.0005432768375612795, -0.020918957889080048, -0.03205685690045357, -0.06450647115707397, -0.1557704657316208, -0.03190118446946144, 0.1660178154706955, -0.027232296764850616, -0.12851008772850037, -0.03812922164797783, 0.084387868642807, -0.12697044014930725, -0.21091748774051666, 0.01631977967917919, 0.2156376838684082, 0.0543818473815918, 0.10265932977199554, -0.03237012028694153, -0.13198739290237427, 0.05282865837216377, 0.06307314336299896, -0.06910989433526993, -0.18527135252952576, 0.13779470324516296, 0.009137163870036602, 0.11944840103387833, 0.1289263218641281, -0.12936845421791077, -0.11257535964250565, 0.047593824565410614, 0.06478230655193329, 0.08447226136922836, 0.12245403230190277, -0.022041266784071922, -0.12533919513225555, -0.17826400697231293]],
    "Lê Anh Tuấn": [-0.15695627, 0.19510159, -0.15634486, -0.06388351, 0.03676739, 0.03944724, -0.03027812, 0.1958531, -0.09724043, 0.14451616, -0.05778842, 0.20706823, 0.06424983, -0.04344543, -0.14257646, -0.09930809, -0.01277258, 0.02906739, 0.05237431, 0.30403095, -0.01466219, 0.18100074, 0.0065696, 0.30906332, -0.09026863, -0.13838473, 0.14529061, -0.15863535, 0.03481157, -0.24671027, 0.04338025, 0.11230342, 0.02108767, 0.02235025, -0.24042626, -0.2879544, -0.0096496, -0.06017737, 0.2202934, 0.06824338, -0.2520787, 0.25250855, 0.1602048, 0.04729021, -0.13875575, -0.14927125, -0.07643689, 0.22590232, -0.21128781, 0.08121033, -0.11873641, 0.18637863, -0.11045516, -0.23139553, 0.21739742, 0.08033784, 0.02928421, -0.32445508, 0.18701646, 0.05888469, 0.09104703, -0.05037745, -0.19869015, 0.3201427, 0.27542302, 0.04318384, 0.0105224, -0.11054607, 0.006693, 0.14437552, -0.15158464, -0.06785316, 0.0814088, 0.06788303, -0.2203948, 0.09729484, -0.20951316, 0.06554867, 0.07956307, 0.00589319, 0.16524857, 0.12642074, -0.3137864, 0.10003052, -0.07972864, 0.17161489, -0.1515607, 0.00533764, 0.00716057, -0.00549625, 0.02197938, -0.24166465, 0.08739661, -0.13485834, -0.06238296, -0.15085243, -0.09330525, -0.05830276, 0.1375024, -0.12171787, -0.12590246, -0.03739173, 0.02231196, -0.02278729, -0.33532184, -0.04012618, -0.08647399, 0.01643546, 0.14463948, -0.08500384, -0.0611588, -0.10258595, 0.0730703, 0.06994288, -0.11944051, 0.19130175, -0.09865497, 0.19163385, 0.1617765, -0.11802447, -0.06261081, 0.0778121, -0.08161799, 0.06523608, -0.12826358, -0.03986386, -0.06976634, -0.12855193],
    "Lê Văn Tiến Đạt": [-0.14684187, 0.214867234, -0.165327474, -0.0592789054, 0.0293862652, 0.0355906375, -0.0389260761, 0.129427150, -0.119333595, 0.138736859, -0.0227927137, 0.201650873, 0.103387810, -0.0441771038, -0.144803509, -0.0844630077, -0.0413179956, 0.0442988724, 0.0496685617, 0.342942148, -0.0400532298, 0.176397994, 0.00710770488, 0.288822800, -0.108540826, -0.142140254, 0.0899832845, -0.134675488, 0.036496114, -0.243298233, 0.119098008, 0.0865138695, 0.0266245306, 0.0412422828, -0.168922022, -0.192032143, 0.0650587082, -0.0733481124, 0.248612836, 0.0810207203, -0.314000458, 0.274114221, 0.116709508, 0.0928292274, -0.134876207, -0.139198795, -0.0349976793, 0.261102349, -0.119542874, 0.103603177, -0.136319801, 0.184987307, -0.0882351026, -0.20050329, 0.212215602, 0.0873797834, 0.0396522023, -0.302329779, 0.195718929, 0.183895323, 0.0650587082, 0.0821431809, -0.181628002, 0.29098627, 0.327459097, 0.0475066341, 0.104056694, -0.144024685, -0.00446385285, 0.179263726, -0.184385017, -0.0264359862, 0.152554795, 0.0657869354, -0.185318515, 0.0548814498, -0.236713007, 0.0214805156, 0.0212592483, 0.00911188498, 0.173900917, 0.082180582, -0.291750193, 0.0863968804, -0.0705581158, 0.221374393, -0.146979615, 0.047284957, 0.0214141775, -0.0312486067, 0.0743644312, -0.214731336, 0.0695597753, -0.215003252, -0.0468420684, -0.16918923, -0.113593221, 0.000176094472, 0.121022828, -0.10454759, -0.147059873, -0.0302230027, 0.0539654084, 0.0134854214, -0.227598354, -0.0428297259, -0.0780961663, -0.0127828149, 0.136823282, -0.0409357361, -0.0878829286, -0.0953402445, 0.0584694445, 0.0426728614, -0.126871064, 0.105682693, -0.107559554, 0.160071179, 0.135933742, -0.141504183, -0.118627377, 0.0919781625, -0.0745701417, 0.0726211742, -0.204039812, -0.0143841682, -0.0847660676, -0.141292736],
    "Phạm Nguyễn Anh Phát": [-0.15988329, 0.22861922, -0.18316853, -0.05059377, 0.05993224, 0.03003198, -0.05419288, 0.13682045, -0.15071715, 0.10461569, -0.00661891, 0.19424531, 0.09363807, -0.04873086, -0.14392261, -0.0847736, -0.03875789, 0.06108027, 0.01675493, 0.40129203, -0.05848183, 0.17932117, -0.01223049, 0.35913888, -0.08670173, -0.14303629, 0.05773105, -0.12688783, 0.03815261, -0.2521697, 0.14550711, 0.07027284, 0.01930542, 0.03217653, -0.15551677, -0.16948044, 0.10158844, -0.0820079, 0.24244504, 0.13390931, -0.29820853, 0.27886006, 0.13308372, 0.09111296, -0.13888884, -0.15802294, -0.05474301, 0.26447147, -0.10258593, 0.13228032, -0.09544527, 0.1822781, -0.11256514, -0.24425332, 0.23748934, 0.09058926, 0.033162, -0.32499346, 0.24358368, 0.02207566, 0.08706254, -0.03996845, -0.17315727, 0.28811884, 0.32059613, 0.05120441, 0.11381303, -0.19410148, 0.0052268, 0.17089227, -0.19234753, -0.00259188, 0.16629802, 0.0737585, -0.19790468, 0.07403558, -0.24265464, 0.02677102, 0.04373121, 0.01723806, 0.14563277, 0.10896764, -0.33836198, 0.12340923, -0.07532871, 0.23703499, -0.1358358, 0.04034945, 0.03772398, -0.06101963, 0.09924202, -0.23915966, 0.06345899, -0.22060558, -0.00342523, -0.20010073, -0.08559002, 0.02456789, 0.12273584, -0.13384423, -0.12959865, -0.02741151, 0.04025497, 0.00247147, -0.2351031, -0.04202021, -0.09369437, -0.00685242, 0.11998409, -0.03018669, -0.08676562, -0.09021944, 0.06372178, 0.05073252, -0.11349921, 0.1492505, -0.15699255, 0.15516944, 0.15118833, -0.14370288, -0.12103127, 0.10801338, -0.02610363, 0.0653234, -0.24901406, -0.05841756, -0.07412682, -0.16882633],
    "Target": [-0.12923355, 0.19687769, -0.05927218, -0.04678532, 0.02523671, 0.09390999, -0.08268842, 0.10341525, 0.11892072, -0.03895992, -0.02831244, 0.19966005, 0.0963534, 0.25770712, -0.17599185, -0.18371049, -0.0293067, 0.05977221, -0.01158621, -0.07453463, 0.14921607, 0.1533998, 0.15797345, -0.16356373, 0.04341213, -0.17034578, 0.03549064, -0.10480014, 0.02219749, -0.20195037, 0.01111129, -0.05416701, 0.06856664, 0.02040656, -0.1398539, -0.23191254, 0.0593542, -0.12888953, 0.15219343, -0.06472621, -0.26431495, 0.29325023, 0.08961257, -0.05396147, -0.11159921, -0.17839779, 0.00400234, 0.01886819, -0.13415477, 0.08371561, 0.04348312, 0.09991992, -0.10012697, -0.13008896, 0.20013674, 0.15888421, 0.04112784, -0.23669146, 0.16150889, -0.08947594, -0.09934361, -0.08470542, -0.14031526, 0.06768908, 0.28917778, -0.00460618, 0.10029362, 0.07933898, 0.1657265, 0.13293272, -0.19411013, -0.05680631, 0.07925221, 0.03842323, 0.22960223, -0.00076151, -0.00829517, 0.01406074, 0.16714884, 0.01142332, 0.08770283, -0.02914083, -0.0569777, 0.06858894, 0.01201356, 0.21423009, -0.17771164, -0.01592552, 0.00319947, 0.04348955, 0.03232195, -0.23479588, 0.033001, -0.03269952, -0.0176157, -0.06151746, -0.17975219, -0.04129697, 0.15068354, -0.10815056, -0.05917197, 0.06127092, 0.02552412, 0.01830088, -0.16123405, -0.03259145, -0.06545661, -0.09351534, 0.16943456, -0.04528689, -0.02542153, -0.08958876, 0.09488184, -0.03742167, -0.13067529, 0.07173075, 0.04461661, 0.12726925, 0.08325134, -0.1378965, -0.14778858, 0.03854216, -0.00130984, -0.01120023, -0.24397114, 0.01886424, -0.06731401, -0.04282768]
}

SPEAKER_RECOGNITION_MODEL_PATH = r"saved_model/train-clean-360-hours-50000-epochs-specaug-8-batch-3-stacks-cpu/mfcc_lstm_model_360h_50000epochs_specaug_8batch_3stacks_cpu.pt"   
SPEAKER_RECOGNITION_MODEL = neural_net.get_speaker_encoder(SPEAKER_RECOGNITION_MODEL_PATH)


audio_file_path = r"temp_recorded_audio/recording_resampled.wav"
audio_file_embedding = inference.get_embedding(audio_file_path, SPEAKER_RECOGNITION_MODEL)

print(embeddings["Trần Đức Trí"][0])
print(audio_file_embedding)
# Plot the embedding vectors
plt.figure(figsize=(10, 6))
plt.plot(embeddings["Trần Đức Trí"], label='Tri Embedding', marker='o')
plt.plot(audio_file_embedding, label='record', marker='o')
plt.show()

# plt.plot(embeddings["Lê Anh Tuấn"], label='Tuan Embedding', marker='o')
# plt.plot(embeddings["Lê Văn Tiến Đạt"], label='Dat Embedding', marker='o')
# plt.plot(embeddings["Phạm Nguyễn Anh Phát"], label='Phat Embedding', marker='o')
# plt.plot(embeddings["Target"], label='Target Embedding', marker='o')

plt.title('Visualization of Embedding Vectors')
plt.xlabel('Index')
plt.ylabel('Value')
plt.legend()
plt.grid(True)
plt.show()

# # Create subplots
# fig, axs = plt.subplots(1, 5, figsize=(14, 6))

# # Plot the embedding vectors
# axs[0].plot(embeddings["Trần Đức Trí"], label='Tri Embedding', marker='o')
# axs[0].set_title('Tri Embedding')
# axs[0].set_xlabel('Index')
# axs[0].set_ylabel('Value')
# axs[0].grid(True)

# axs[1].plot(embeddings["Lê Anh Tuấn"], label='Tuan Embedding', marker='o')
# axs[1].set_title('Tuan Embedding')
# axs[1].set_xlabel('Index')
# axs[1].set_ylabel('Value')
# axs[1].grid(True)

# axs[2].plot(embeddings["Lê Văn Tiến Đạt"], label='Dat Embedding', marker='o')
# axs[2].set_title('Dat Embedding')
# axs[2].set_xlabel('Index')
# axs[2].set_ylabel('Value')
# axs[2].grid(True)

# axs[3].plot(embeddings["Phạm Nguyễn Anh Phát"], label='Phat Embedding', marker='o')
# axs[3].set_title('Phat Embedding')
# axs[3].set_xlabel('Index')
# axs[3].set_ylabel('Value')
# axs[3].grid(True)

# axs[4].plot(embeddings["Target"], label='Target Embedding', marker='o')
# axs[4].set_title('Target Embedding')
# axs[4].set_xlabel('Index')
# axs[4].set_ylabel('Value')
# axs[4].grid(True)


# plt.tight_layout()
# plt.show()